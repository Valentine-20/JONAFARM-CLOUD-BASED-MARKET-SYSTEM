<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distributor Dashboard - JonaFarm</title>
<style>
body { font-family: Arial, sans-serif; background-color: #f5f5dc; margin: 0; padding: 0; }
header { display: flex; align-items: center; justify-content: center; gap: 15px; background-color: #a0522d; color: white; padding: 15px; border-radius: 0 0 10px 10px; }
header img { height: 50px; border-radius: 8px; }
header h1 { margin: 0; font-size: 24px; }
table { width: 95%; margin: 20px auto; border-collapse: collapse; }
th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
th { background-color: #d2691e; color: white; }
button { padding: 5px 10px; background-color: #d2691e; color: white; border: none; border-radius: 5px; cursor: pointer; }
button:hover { background-color: #8b4513; }
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="JonaFarm Logo">
  <h1>Distributor Dashboard</h1>
</header>

<table id="orders-table">
  <thead>
    <tr>
      <th>Order ID</th>
      <th>Buyer</th>
      <th>Phone</th>
      <th>Address</th>
      <th>Product</th>
      <th>Quantity</th>
      <th>Order Date</th>
      <th>Status</th>
      <th>Update Status</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const distributor = JSON.parse(localStorage.getItem('distributor'));
if (!distributor) window.location.href = 'distributor-login.html';

async function loadOrders() {
  try {
    const res = await fetch('/orders/distributor');
    const orders = await res.json();
    const tbody = document.querySelector('#orders-table tbody');
    tbody.innerHTML = '';

    orders
      .filter(o => o.distributor === distributor.username || o.distributor === '') // only orders for this distributor
      .forEach(order => {
        const orderDate = order.order_date ? new Date(order.order_date).toLocaleString() : 'N/A';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${order.id}</td>
          <td>${order.buyer}</td>
          <td>${order.phone || 'N/A'}</td>
          <td>${order.address}</td>
          <td>${order.product}</td>
          <td>${order.quantity}</td>
          <td>${orderDate}</td>
          <td id="status-${order.id}">${order.status}</td>
          <td>
            ${order.status !== 'Delivered' ? `<button onclick="markDelivered(${order.id})">Mark Delivered</button>` : 'âœ… Delivered'}
          </td>
        `;
        tbody.appendChild(tr);
      });
  } catch(err) { console.error(err); }
}

async function markDelivered(orderId) {
  try {
    const res = await fetch('/orders/distributor/update', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: orderId, status: 'Delivered', distributor: distributor.username })
    });

    const data = await res.json();
    if (res.ok) loadOrders();
    else alert(data.message || 'Error updating order');
  } catch(err) { console.error(err); }
}

loadOrders();
</script>

</body>
</html>





























